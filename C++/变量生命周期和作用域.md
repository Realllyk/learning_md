# C/C++ 变量作用域与生命周期总结

## 1. 基本概念
在 C/C++ 中，每个变量有两个重要属性：  
- **作用域（Scope）**：描述变量在程序中**可见性**的范围。  
- **生命周期（Lifetime）**：描述变量在程序运行时**存在的时间段**。

---

## 2. 变量类型与作用域/生命周期

### 2.1 全局变量
- **定义**：在所有函数外定义的变量。  
- **作用域**：从定义处到文件结尾（可用 `extern` 在其他文件引用）。  
- **生命周期**：从程序开始运行直到结束。  

```cpp
#include <iostream>
using namespace std;

int g = 10; // 全局变量

void foo() {
    cout << g << endl;
}
```

---

### 2.2 静态全局变量
- **定义**：在全局变量前加 `static`。  
- **作用域**：仅在当前源文件内可见。  
- **生命周期**：从程序开始到结束（和普通全局变量一样长）。  

```cpp
static int sg = 20; // 静态全局变量，仅本文件可见
```

---

### 2.3 局部变量
- **定义**：在函数或语句块中定义的变量。  
- **作用域**：函数或语句块内部。  
- **生命周期**：进入作用域时创建，离开作用域时销毁。  

```cpp
void foo() {
    int x = 5;  // 局部变量
    cout << x << endl;
} // x 在这里销毁
```

---

### 2.4 静态局部变量
- **定义**：在局部变量前加 `static`。  
- **作用域**：函数或语句块内部。  
- **生命周期**：从第一次执行到定义语句时开始初始化，一直到程序结束。  
- **特点**：函数多次调用时，值会被“记住”。  

```cpp
void counter() {
    static int cnt = 0; // 静态局部变量
    cnt++;
    cout << cnt << endl;
}
```

---

### 2.5 形参（函数参数）
- **定义**：函数定义中的参数。  
- **作用域**：整个函数体内有效。  
- **生命周期**：函数调用时创建，函数返回时销毁。  

```cpp
void foo(int n) { // n 是形参
    cout << n << endl;
}
```

---

### 2.6 语句块内定义的变量
- **定义**：出现在 `{}` 内的变量。  
- **作用域**：限定在该语句块中。  
- **生命周期**：进入语句块时创建，退出时销毁。  

```cpp
int main() {
    {
        int y = 100;
        cout << y << endl;
    }
    // cout << y; // 错误：y 已经超出作用域
}
```

---

## 3. `extern` 与跨文件变量
- **作用**：声明一个变量在别的文件中定义。  
- **编译阶段**：告诉编译器不要为它分配空间。  
- **链接阶段**：由链接器去找实际的定义。  

最佳实践：  
- `.h` 文件：用 `extern` 声明。  
- `.cpp` 文件：写唯一的定义。  

```cpp
// global.h
extern int g;  

// global.cpp
int g = 42;  

// main.cpp
#include "global.h"
#include <iostream>
using namespace std;
int main() { cout << g << endl; }
```

---

## 4. 生命周期与作用域对比表

| 类型           | 作用域              | 生命周期               | 特点 |
|----------------|---------------------|------------------------|------|
| 全局变量       | 整个文件（可 extern）| 程序运行期             | 跨函数共享数据 |
| 静态全局变量   | 当前文件             | 程序运行期             | 限制作用范围，避免冲突 |
| 局部变量       | 函数/语句块内        | 进入作用域 → 离开销毁  | 临时存储 |
| 静态局部变量   | 函数/语句块内        | 程序运行期             | 保存状态 |
| 形参           | 函数体内             | 调用时创建 → 返回销毁  | 临时传递 |
| 块内变量       | 块内                 | 进入块时创建，退出销毁 | 控制局部作用 |

---

## 5. 总结
- **作用域**：编译时概念，决定“在哪能看见变量”。  
- **生命周期**：运行时概念，决定“变量何时存在”。  
- 全局变量和静态变量的生命周期 = 程序整个运行期。  
- 局部变量和形参的生命周期 = 进入作用域 → 离开销毁。  
- `extern` 用于跨文件共享全局变量。  
