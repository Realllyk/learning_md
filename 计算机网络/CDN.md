# CDN 学习笔记

## 一、静态资源与动态资源

### 1. 静态资源
- **定义**：内容固定，不随用户或时间变化。
- **典型类型**：图片（.jpg, .png）、视频（.mp4）、CSS、JS、字体文件、固定 HTML 页面。
- **特点**：
  - 可长时间缓存（浏览器、CDN 都能缓存）。
  - 更新频率低，一次生成，多次使用。

### 2. 动态资源
- **定义**：内容会随用户、请求参数或时间变化，需要后端实时计算。
- **典型类型**：订单列表、用户信息、实时价格、个性化推荐。
- **特点**：
  - 通常不可直接缓存（因人而异、因时而异）。
  - 必须经过后端逻辑处理。
  - 部分动态资源可设置短时缓存（例如新闻首页每 30 秒更新）。

---

## 二、CDN 的一般作用

### 1. 静态加速
- **原理**：把静态资源（图片、视频、CSS、JS 等）缓存到分布式的边缘节点。
- **效果**：用户就近访问，减少跨地域访问延迟，减轻源站压力。
- **应用场景**：网站静态文件、应用更新包、音视频点播。

### 2. 动态加速
- **背景**：动态请求（如登录、下单、实时数据）无法缓存。
- **方法**：
  - **链路优化**：智能选择最优网络路径，避免拥塞。
  - **协议优化**：TCP/SSL 连接复用、HTTP/2、QUIC。
  - **边缘代理**：用户请求先到就近节点，再走 CDN 内部专线传输到源站。
  - **安全增强**：边缘节点可做 WAF、防 DDoS。
- **效果**：虽然结果仍需源站生成，但传输更快、更稳定。

### 3. 边缘计算（扩展功能）
- 在 CDN 边缘节点直接运行逻辑（如鉴权、A/B 测试、内容裁剪）。
- 减少请求回源，提升实时性。

---

## 三、CDN 的调度流程

### 1. DNS 调度（最常见）
- **原理**：用户解析域名时，CDN 的智能 DNS 根据用户所在地区/运营商返回最近的节点 IP。
- **流程**：
  1. 浏览器请求解析 `cdn.example.com`。
  2. 智能 DNS 识别用户来源，返回最近节点 IP。
  3. 用户就近访问资源。
- **优点**：简单有效，应用最广。

### 2. HTTP 重定向调度
- **原理**：用户请求统一入口后，由入口服务器返回 302 重定向到最佳节点。
- **缺点**：多一次跳转，性能略差。

### 3. Anycast 调度
- **原理**：所有 CDN 节点广播相同的 IP，通过 BGP 路由让请求自动落到最近的节点。
- **优点**：无需 DNS 调度，路径自动优化。
- **缺点**：依赖运营商路由策略，运维复杂。

---

## 四、总结
1. **静态资源**：固定内容，可缓存，CDN 最主要的加速对象。
2. **动态资源**：内容随用户/时间变化，不能缓存，但 CDN 可通过动态加速优化传输。
3. **CDN 调度**：主要依赖 DNS 调度，也有 HTTP 重定向和 Anycast 三种方式。
4. **核心价值**：加速访问、减轻源站压力、提升可用性、安全防护。

