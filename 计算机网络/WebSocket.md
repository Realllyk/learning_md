WebSocket 是前后端开发中非常常见、重要的一种**实时通信协议（应用层）**。下面我会从基础概念、运行原理、与 HTTP 的区别、应用场景等方面，**用简单明了的方式讲一遍 WebSocket**。


### ✅ 一句话理解 WebSocket
> **WebSocket 是一种在浏览器和服务器之间建立的** **“持久化、全双工、低延迟”** 的通信协议，可以实现**实时数据传输**。



### 🔧 它和 HTTP 有什么不同？

| 特性     | HTTP          | WebSocket                      |
| ------ | ------------- | ------------------------------ |
| 连接方式   | 请求-响应，一次一条消息  | 建立连接后，**双向实时通信**               |
| 是否持久化  | ❌（每次请求建立连接）   | ✅（建立后长期保持）                     |
| 数据传输效率 | 较低，头信息冗余      | 更高，头信息简洁                       |
| 典型应用   | 页面加载、REST API | **实时聊天、在线游戏、股票行情等**            |
| 建立方式   | 浏览器主动请求       | **先通过 HTTP 握手，再升级成 WebSocket** |


### 🧠 工作原理（简化版）
1. **客户端发起请求（类似 HTTP）**：
```http
GET /chat HTTP/1.1
Host: example.com
Upgrade: websocket
Connection: Upgrade
Sec-WebSocket-Key: xxxxx==
Sec-WebSocket-Version: 13
```


**2.服务器响应确认，升级协议**：
```java
HTTP/1.1 101 Switching Protocols
Upgrade: websocket
Connection: Upgrade
Sec-WebSocket-Accept: yyyyy==
```


**3.连接建立成功后，双方就可以实时发送消息了（无需重新连接）**。



### 🔄 全双工通信

- 浏览器（或前端应用）可以主动向服务端发送数据；
- 服务端也可以**随时**主动向客户端发送数据（这是 HTTP 无法做到的）；
- 非常适合需要“推送”的场景，比如**直播评论、实时报警、协同编辑等**。


### 注意事项
- WebSocket 默认端口：`ws://` 是 80，`wss://` 是 443（加密的）
- 有些浏览器或中间代理服务器可能拦截 WebSocket，需配置跨域或反向代理（如 Nginx）
- 若连接断开，需要客户端自动重连逻辑（WebSocket 没有内置重连）


---


## 既然Http2.0都可以进行双端通信了，为什么要使用WebSocket

### HTTP/2 是“全双工”**协议
- 它的确支持 **“多路复用”** 和 **“双向流”**。
- 可以让**一个 TCP 连接同时处理多个请求/响应流**，每个流互不干扰。
- 服务端可以主动推送数据给客户端（Server Push）。
- 所以很多人会问：**那我还要 WebSocket 干嘛？**


### 🔍 HTTP/2 和 WebSocket 的核心区别

| 维度         | HTTP/2                     | WebSocket                   |
| ---------- | -------------------------- | --------------------------- |
| 设计目标       | 加快网页加载，提高 HTTP 请求效率        | 实现浏览器和服务端之间的**实时通信**        |
| 通信方式       | 请求-响应为主，服务端可以推送            | 真正意义上的 **双向通信**（服务端随时发送）    |
| 数据格式       | 文本（HTTP headers + body）    | **任意格式（二进制 / 文本）**          |
| 建立过程       | 客户端发起请求，服务端响应              | 先 HTTP 握手，后升级为 WebSocket 协议 |
| 保持连接       | 请求结束即释放资源                  | 建立后保持持久连接                   |
| 适合场景       | 网页加载优化、静态资源请求              | 聊天、协同编辑、在线游戏、行情推送等          |
| 原生浏览器支持推送？ | ❌ 大多数浏览器限制了 Server Push 使用 | ✅ 浏览器原生支持 WebSocket 接收服务端推送 |


### 关键点区别总结

| 关键点                                                | HTTP/2 是双向，但仍以请求-响应为核心 |
| -------------------------------------------------- | ---------------------- |
| WebSocket 是事件驱动的持续连接，**随时可以发消息，无需请求发起**            |                        |
| HTTP/2 设计用于“**高效传输网页资源**”，WebSocket 用于“**实时消息通信**” |                        |


### ⚠️ 最后注意：
- WebSocket 可以和 HTTP/2 共存，但**WebSocket 协议本身只基于 HTTP/1.1 握手升级**（截至目前 HTTP/2 不支持原生 WebSocket 握手）。
- 为了支持 WebSocket over HTTP/2，目前有些厂商提出了新的草案（如 `WebTransport`），但不算广泛支持。