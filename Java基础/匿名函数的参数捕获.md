# Java vs C++ 匿名函数（Lambda）参数捕获总结

## 1. Java Lambda 捕获规则

### 规则
- **只能捕获 final 或 effectively final** 的局部变量。  
- 捕获的是 **值的副本**（基本类型值或对象引用）。  
- Lambda 运行时使用的是这份副本，而不是方法栈里的原始局部变量。  
- **不允许修改捕获的局部变量**（否则编译报错）。  
- 如果是对象引用，引用不可变，但对象内容可以改。  

### 示例
```java
public class Demo {
    public static void main(String[] args) {
        int x = 10; // effectively final

        Runnable r = () -> System.out.println(x);
        r.run(); // 输出 10

        // x = 20; // ❌ 会编译报错，x 必须保持 effectively final

        final StringBuilder sb = new StringBuilder("hello");
        Runnable r2 = () -> System.out.println(sb.toString());
        sb.append(" world"); // ✅ 修改对象内容
        r2.run(); // 输出 hello world
    }
}
```

---

## 2. C++ Lambda 捕获规则

### 规则
- C++ 提供多种捕获方式，开发者可明确指定：  
  - **值捕获 `[=]`**：拷贝一份值，和 Java 类似。  
  - **引用捕获 `[&]`**：直接使用外部变量引用。  
  - **按变量指定**：`[a, &b]` 表示 a 按值捕获，b 按引用捕获。  
  - **mutable 修饰符**：允许修改值捕获的副本。  

### 示例
```cpp
#include <iostream>
using namespace std;

int main() {
    int a = 1, b = 2;

    // 值捕获
    auto f1 = [=]() { cout << "a=" << a << " b=" << b << endl; };
    a = 10; b = 20;
    f1(); // 输出 a=1 b=2 (捕获时的副本)

    // 引用捕获
    auto f2 = [&]() { cout << "a=" << a << " b=" << b << endl; };
    a = 30; b = 40;
    f2(); // 输出 a=30 b=40 (引用外部变量)

    // 混合捕获
    int c = 5, d = 6;
    auto f3 = [c, &d]() { cout << "c=" << c << " d=" << d << endl; };
    d = 7;
    f3(); // 输出 c=5 d=7

    // 值捕获 + mutable
    int x = 100;
    auto f4 = [=]() mutable { x++; cout << "x=" << x << endl; };
    f4(); // 输出 x=101 (修改副本)
    cout << "外部 x=" << x << endl; // 外部 x=100 (不受影响)

    return 0;
}
```

---

## 3. 对比总结表

| 特性 | Java Lambda | C++ Lambda |
|------|-------------|-------------|
| 捕获方式 | 只能值捕获（final/effectively final） | 值捕获 `[=]`、引用捕获 `[&]`、混合捕获 |
| 可修改性 | 不允许修改局部变量（必须 final） | 值捕获可 `mutable`，引用捕获可直接修改外部变量 |
| 对象引用 | 引用本身不可变，但对象内容可变 | 可值捕获引用（对象副本），也可引用捕获（直接修改外部对象） |
| 灵活性 | 简单，限制多 | 高度灵活，可精细指定 |

---

✅ **一句话总结**  
- **Java**：安全、简化，捕获规则严格（只能 final / effectively final，捕获副本）。  
- **C++**：灵活，支持值/引用捕获，甚至可 mutable 修改副本，语义更自由。  
